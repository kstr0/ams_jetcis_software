# Version 8 (07/01/2021)

def getSensorInfo(imager):
    controlParams = {
        "width" : 1600,
        "height" : 1400,
        "widthDISP" : 1600*0.3,
        "heightDISP" : 1400*0.3,
        "widthDMA" : 1600,
        "heightDMA" : 1400,
        "bpp" : 12,
        "fps" : 5,
        "dtMode" : 3
    }
    return controlParams


def resetSensor(imager):
    imager.setSensorI2C(0x2d)
    imager.type(0)  # Reg=8bit, val=8bit

    # Disable master switch
    imager.write(0x62, 0x00)

    # Rewrite default LDO voltage registers
    imager.setSensorI2C(0x2d)
    imager.type(0) # Reg=8bit, val=8bit

    # DCDC1=0V
    imager.write(0x05, 0x00)
    # DCDC4=0V
    imager.write(0x0E, 0x0)
    # LDO1=1.35V VDDLO_PLL
    imager.write(0x11, 0x0)
    # LDO2=0.0V
    imager.write(0x14, 0x00)
    # LDO3=0.0V
    imager.write(0x17, 0x00)
    # LDO4=2.85V VDDHI alternativ
    imager.write(0x1A, 0x00)
    # LDO5=0.0V
    imager.write(0x1C, 0x00)
    # LDO6=0.0V
    imager.write(0x1D, 0x00)
    # LDO7=1.35V VDDLO_DIG
    imager.write(0x1E, 0x0)
    # LDO8=0.0V
    imager.write(0x1F, 0x00)
    # Disable LDO9 Lock
    imager.write(0x24, 0x48)
    # LDO9=2.85V VDDHI
    imager.write(0x20, 0x00)
    # LDO10=1.35V VDDLO_ANA
    imager.write(0x21, 0x0)

    # Enable master switch
    time.sleep(50e-6)
    imager.write(0x62, 0x0D)  # enable master switch
    time.sleep(50e-6)

    # start PMIC
    # Keep LDOs always on
    time.sleep(50e-3)
    try:
        imager.read(0x20)
    except:
        pass
    imager.write(0x27, 0xFF)
    imager.write(0x28, 0xFF)
    imager.write(0x29, 0x00)
    imager.write(0x2A, 0x00)
    imager.write(0x2B, 0x00)

    ## Unused LDO off
    time.sleep(50e-6)
    # set GPIO1=0
    imager.write(0x41, 0x04)
    # DCDC2=0.0V SPARE_PWR1
    imager.write(0x01, 0x00)
    imager.write(0x08, 0x00)
    # DCDC3=0V SPARE_PWR1
    imager.write(0x02, 0x00)
    imager.write(0x0B, 0x00)
    # LDO2=0.0V
    imager.write(0x14, 0x00)
    # LDO3=0.0V
    imager.write(0x17, 0x00)
    # LDO5=0.0V
    imager.write(0x1C, 0x00)
    # LDO6=0.0V
    imager.write(0x1D, 0x00)
    # LDO8=0.0V
    imager.write(0x1F, 0x00)

    ## Enable 2.85V
    time.sleep(50e-6)
    # LDO4=2.85V VDDHI alternativ
    imager.write(0x1A, 0x00)
    # Disable LDO9 Lock
    imager.write(0x24, 0x48)
    # LDO9=2.85V VDDHI
    imager.read(0x20)
    imager.write(0x20, 0xB9)
    imager.read(0x20)

    ## Enable 1.35V
    time.sleep(700e-6)
    # LDO1=1.35V VDDLO_PLL
    imager.write(0x12, 0x16)
    imager.write(0x10, 0x16)
    imager.write(0x11, 0x96)
    # LDO7=1.35V VDDLO_DIG
    imager.write(0x1E, 0x96)
    # LDO10=1.35V VDDLO_ANA
    imager.write(0x21, 0x96)

    ## Enable 1.80V
    time.sleep(50e-6)
    # DCDC1=1.8V VINLDO1p8 >=1P8
    imager.write(0x00, 0x00)
    imager.write(0x04, 0x34)
    imager.write(0x06, 0xBF)
    imager.write(0x05, 0xB4)
    # DCDC4=1.8V VDDIO
    imager.write(0x03, 0x00)
    imager.write(0x0D, 0x34)
    imager.write(0x0F, 0xBF)
    imager.write(0x0E, 0xB4)

    ## Enable CLK_IN
    # Enable GPIO2 for mclk XTALL
    time.sleep(50e-6)
    imager.write(0x42, 5)

    ## Enable green LED
    time.sleep(50e-6)
    imager.write(0x45, 0x40)
    imager.write(0x57, 0x02)
    imager.write(0x5D, 0x10)
    imager.write(0x61, 0x10)

    # I2C address LED and length (addr=8bit, val=8bit)
    imager.setSensorI2C(0x53)
    imager.type(0)
    # Turn off LED driver
    imager.write(0x10, 0x08)

    # Init sensor
    imager.setSensorI2C(0x54)
    imager.type(1) # reg=16bit, val=8bit
    # Set input clock speed to 24MHz
    imager.setmclk(24000000)
    imager.setDelay(0)
    # Reset sensor
    imager.reset(1)
    imager.wait(2000)


def checkSensor(imager):
    imager.setSensorI2C(0x54)
    imager.type(1)
    # Read ID 0x3=?, 0x4=?
    imager.read(0x0003)
    imager.read(0x0004)


len_eoi = 0
f_clk_in = 38.4e6
otp_gain_trims = []

def calc_len_eoi(imager):
    global len_eoi
    addr_start_eoi = imager.read(0x305A) + (imager.read(0x305B) << 8)
    addr_stop_eoi = imager.read(0x305C) + (imager.read(0x305D) << 8)
    val = '{:08b}'.format(imager.read(0x302F))
    gran_eoi = 2 ** int(val[-4:-2], 2)
    len_eoi = 0
    for addr in range(addr_start_eoi, addr_stop_eoi + 1, 1):
        cmd = 0
        for b in range(0, 6, 1):
            cmd += (imager.read(0x3300 + b + addr * 6) << 8 * b)
        dly = cmd % 0x400
        len_eoi += dly * gran_eoi


def otp_read(imager, otp_address):
    imager.write(0x0086, otp_address)
    imager.write(0x0080, 0x02)
    return imager.read(0x0082)


def trim_restore(imager):
    global otp_gain_trims
    # Set I2C address
    imager.setSensorI2C(0x54)
    imager.type(1)
    # OTP power on
    imager.write(0x0080, 0x04)
    # Write OTP to image sensor when programmed
    if (otp_read(imager, 0x1d) != 0xff):
        reg_list = [0x4015, 0x4016, 0x4017, 0x4018, 0x403B, 0x4040, 0x4041, 0x4042, 0x402a, 0x4029, 0x4009]
        for i in range(0, len(reg_list)):
            otp_data = otp_read(imager, i)
            imager.write(reg_list[i], otp_data)
        otp_gain_trims = [otp_data, otp_read(imager, 0x0b), otp_read(imager, 0x0c)]
    # OTP power off
    imager.write(0x0080, 0x08)


def initSensor(imager):
    imager.setSensorI2C(0x54)
    imager.type(1)
    # Read ID 0x3=?, 0x4=?
    imager.read(0x0003)
    imager.read(0x0004)
    imager.wait(100)
    # Sensor uploads
    imager.write(0x1003, 0x04)
    imager.write(0x6006, 0x00)
    imager.write(0x6010, 0x00)
    imager.write(0x6012, 0x01)
    imager.write(0x6013, 0x00)
    imager.write(0x601f, 0x00)
    imager.write(0x6003, 0x01)
    imager.write(0x6006, 0x01)
    imager.write(0x2063, 0x00)
    imager.write(0x24dc, 0x00)
    imager.write(0x1012, 0x80)
    imager.write(0x1013, 0x02)
    imager.write(0x1002, 0x04)
    imager.write(0x1003, 0x10)
    imager.write(0x10f0, 0x01)
    imager.write(0x6006, 0x01)
    imager.write(0x1003, 0x04)
    imager.write(0x1002, 0x04)
    imager.write(0x1003, 0x10)
    imager.write(0x1077, 0x00)
    imager.write(0x1078, 0x00)
    imager.write(0x1009, 0x0a)
    imager.write(0x100a, 0x00)
    imager.write(0x1006, 0x01)
    imager.write(0x10f1, 0x01)
    imager.write(0x402c, 0x60)
    imager.write(0x4006, 0x0f)
    imager.write(0x2045, 0x01)
    imager.write(0x2048, 0x01)
    imager.write(0x3064, 0x00)
    imager.write(0x3065, 0xf0)
    imager.write(0x4044, 0x65)
    imager.write(0x4018, 0x3f)
    imager.write(0x403b, 0x0d)
    imager.write(0x4047, 0x80)
    imager.write(0x403e, 0x10)
    imager.write(0x4013, 0x13)
    imager.write(0x401f, 0x09)
    imager.write(0x4020, 0x13)
    imager.write(0x4017, 0x05)
    imager.write(0x4040, 0x04)
    imager.write(0x4041, 0x47)
    imager.write(0x4042, 0x04)
    imager.write(0x1003, 0x04)
    imager.write(0x204b, 0x00)
    imager.write(0x24dc, 0x00)
    imager.write(0x205d, 0x00)
    imager.write(0x3016, 0x00)
    imager.write(0x3017, 0x2c)
    imager.write(0x3018, 0x8c)
    imager.write(0x3019, 0x45)
    imager.write(0x301a, 0x05)
    imager.write(0x3013, 0x0a)
    imager.write(0x301b, 0x00)
    imager.write(0x301c, 0x04)
    imager.write(0x301d, 0x88)
    imager.write(0x301e, 0x45)
    imager.write(0x301f, 0x05)
    imager.write(0x3020, 0x00)
    imager.write(0x3021, 0x04)
    imager.write(0x3022, 0x88)
    imager.write(0x3023, 0x45)
    imager.write(0x3024, 0x05)
    imager.write(0x3025, 0x00)
    imager.write(0x3026, 0x04)
    imager.write(0x3027, 0x88)
    imager.write(0x3028, 0x45)
    imager.write(0x3029, 0x05)
    imager.write(0x302f, 0x00)
    imager.write(0x3056, 0x00)
    imager.write(0x3057, 0x00)
    imager.write(0x3300, 0x01)
    imager.write(0x3301, 0x00)
    imager.write(0x3302, 0xb0)
    imager.write(0x3303, 0xb0)
    imager.write(0x3304, 0x16)
    imager.write(0x3305, 0x15)
    imager.write(0x3306, 0x01)
    imager.write(0x3307, 0x00)
    imager.write(0x3308, 0x30)
    imager.write(0x3309, 0xa0)
    imager.write(0x330a, 0x16)
    imager.write(0x330b, 0x15)
    imager.write(0x330c, 0x01)
    imager.write(0x330d, 0x00)
    imager.write(0x330e, 0x30)
    imager.write(0x330f, 0xa0)
    imager.write(0x3310, 0x16)
    imager.write(0x3311, 0x15)
    imager.write(0x3312, 0x01)
    imager.write(0x3313, 0x00)
    imager.write(0x3314, 0x30)
    imager.write(0x3315, 0xa0)
    imager.write(0x3316, 0x16)
    imager.write(0x3317, 0x15)
    imager.write(0x3318, 0x01)
    imager.write(0x3319, 0x00)
    imager.write(0x331a, 0x30)
    imager.write(0x331b, 0xa0)
    imager.write(0x331c, 0x16)
    imager.write(0x331d, 0x15)
    imager.write(0x331e, 0x01)
    imager.write(0x331f, 0x00)
    imager.write(0x3320, 0x30)
    imager.write(0x3321, 0xa0)
    imager.write(0x3322, 0x16)
    imager.write(0x3323, 0x15)
    imager.write(0x3324, 0x01)
    imager.write(0x3325, 0x00)
    imager.write(0x3326, 0x30)
    imager.write(0x3327, 0xa0)
    imager.write(0x3328, 0x16)
    imager.write(0x3329, 0x15)
    imager.write(0x332a, 0x2b)
    imager.write(0x332b, 0x00)
    imager.write(0x332c, 0x30)
    imager.write(0x332d, 0xa0)
    imager.write(0x332e, 0x16)
    imager.write(0x332f, 0x15)
    imager.write(0x3330, 0x01)
    imager.write(0x3331, 0x00)
    imager.write(0x3332, 0x10)
    imager.write(0x3333, 0xa0)
    imager.write(0x3334, 0x16)
    imager.write(0x3335, 0x15)
    imager.write(0x3058, 0x08)
    imager.write(0x3059, 0x00)
    imager.write(0x305a, 0x09)
    imager.write(0x305b, 0x00)
    imager.write(0x3336, 0x01)
    imager.write(0x3337, 0x00)
    imager.write(0x3338, 0x90)
    imager.write(0x3339, 0xb0)
    imager.write(0x333a, 0x16)
    imager.write(0x333b, 0x15)
    imager.write(0x333c, 0x1f)
    imager.write(0x333d, 0x00)
    imager.write(0x333e, 0x10)
    imager.write(0x333f, 0xa0)
    imager.write(0x3340, 0x16)
    imager.write(0x3341, 0x15)
    imager.write(0x3342, 0x52)
    imager.write(0x3343, 0x00)
    imager.write(0x3344, 0x10)
    imager.write(0x3345, 0x80)
    imager.write(0x3346, 0x16)
    imager.write(0x3347, 0x15)
    imager.write(0x3348, 0x01)
    imager.write(0x3349, 0x00)
    imager.write(0x334a, 0x10)
    imager.write(0x334b, 0x80)
    imager.write(0x334c, 0x16)
    imager.write(0x334d, 0x1d)
    imager.write(0x334e, 0x01)
    imager.write(0x334f, 0x00)
    imager.write(0x3350, 0x50)
    imager.write(0x3351, 0x84)
    imager.write(0x3352, 0x16)
    imager.write(0x3353, 0x1d)
    imager.write(0x3354, 0x18)
    imager.write(0x3355, 0x00)
    imager.write(0x3356, 0x10)
    imager.write(0x3357, 0x84)
    imager.write(0x3358, 0x16)
    imager.write(0x3359, 0x1d)
    imager.write(0x335a, 0xa0)
    imager.write(0x335b, 0x00)
    imager.write(0x335c, 0x10)
    imager.write(0x335d, 0xc4)
    imager.write(0x335e, 0x14)
    imager.write(0x335f, 0x1d)
    imager.write(0x3360, 0xa5)
    imager.write(0x3361, 0x00)
    imager.write(0x3362, 0x10)
    imager.write(0x3363, 0x84)
    imager.write(0x3364, 0x16)
    imager.write(0x3365, 0x1d)
    imager.write(0x3366, 0x01)
    imager.write(0x3367, 0x00)
    imager.write(0x3368, 0x90)
    imager.write(0x3369, 0x84)
    imager.write(0x336a, 0x16)
    imager.write(0x336b, 0x1d)
    imager.write(0x336c, 0x12)
    imager.write(0x336d, 0x00)
    imager.write(0x336e, 0x10)
    imager.write(0x336f, 0x84)
    imager.write(0x3370, 0x16)
    imager.write(0x3371, 0x15)
    imager.write(0x3372, 0x32)
    imager.write(0x3373, 0x00)
    imager.write(0x3374, 0x30)
    imager.write(0x3375, 0x84)
    imager.write(0x3376, 0x16)
    imager.write(0x3377, 0x15)
    imager.write(0x3378, 0x26)
    imager.write(0x3379, 0x00)
    imager.write(0x337a, 0x10)
    imager.write(0x337b, 0x84)
    imager.write(0x337c, 0x16)
    imager.write(0x337d, 0x15)
    imager.write(0x337e, 0xa0)
    imager.write(0x337f, 0x00)
    imager.write(0x3380, 0x10)
    imager.write(0x3381, 0xc4)
    imager.write(0x3382, 0x14)
    imager.write(0x3383, 0x15)
    imager.write(0x3384, 0xa9)
    imager.write(0x3385, 0x00)
    imager.write(0x3386, 0x10)
    imager.write(0x3387, 0x84)
    imager.write(0x3388, 0x16)
    imager.write(0x3389, 0x15)
    imager.write(0x338a, 0x41)
    imager.write(0x338b, 0x00)
    imager.write(0x338c, 0x10)
    imager.write(0x338d, 0x80)
    imager.write(0x338e, 0x16)
    imager.write(0x338f, 0x15)
    imager.write(0x3390, 0x02)
    imager.write(0x3391, 0x00)
    imager.write(0x3392, 0x10)
    imager.write(0x3393, 0xa0)
    imager.write(0x3394, 0x16)
    imager.write(0x3395, 0x15)
    imager.write(0x305c, 0x18)
    imager.write(0x305d, 0x00)
    imager.write(0x305e, 0x19)
    imager.write(0x305f, 0x00)
    imager.write(0x3396, 0x01)
    imager.write(0x3397, 0x00)
    imager.write(0x3398, 0x90)
    imager.write(0x3399, 0x30)
    imager.write(0x339a, 0x56)
    imager.write(0x339b, 0x57)
    imager.write(0x339c, 0x01)
    imager.write(0x339d, 0x00)
    imager.write(0x339e, 0x10)
    imager.write(0x339f, 0x20)
    imager.write(0x33a0, 0xd6)
    imager.write(0x33a1, 0x17)
    imager.write(0x33a2, 0x01)
    imager.write(0x33a3, 0x00)
    imager.write(0x33a4, 0x10)
    imager.write(0x33a5, 0x28)
    imager.write(0x33a6, 0xd6)
    imager.write(0x33a7, 0x17)
    imager.write(0x33a8, 0x03)
    imager.write(0x33a9, 0x00)
    imager.write(0x33aa, 0x10)
    imager.write(0x33ab, 0x20)
    imager.write(0x33ac, 0xd6)
    imager.write(0x33ad, 0x17)
    imager.write(0x33ae, 0x61)
    imager.write(0x33af, 0x00)
    imager.write(0x33b0, 0x10)
    imager.write(0x33b1, 0x20)
    imager.write(0x33b2, 0xd6)
    imager.write(0x33b3, 0x15)
    imager.write(0x33b4, 0x01)
    imager.write(0x33b5, 0x00)
    imager.write(0x33b6, 0x10)
    imager.write(0x33b7, 0x20)
    imager.write(0x33b8, 0xd6)
    imager.write(0x33b9, 0x1d)
    imager.write(0x33ba, 0x01)
    imager.write(0x33bb, 0x00)
    imager.write(0x33bc, 0x50)
    imager.write(0x33bd, 0x20)
    imager.write(0x33be, 0xd6)
    imager.write(0x33bf, 0x1d)
    imager.write(0x33c0, 0x2c)
    imager.write(0x33c1, 0x00)
    imager.write(0x33c2, 0x10)
    imager.write(0x33c3, 0x20)
    imager.write(0x33c4, 0xd6)
    imager.write(0x33c5, 0x1d)
    imager.write(0x33c6, 0x01)
    imager.write(0x33c7, 0x00)
    imager.write(0x33c8, 0x90)
    imager.write(0x33c9, 0x20)
    imager.write(0x33ca, 0xd6)
    imager.write(0x33cb, 0x1d)
    imager.write(0x33cc, 0x83)
    imager.write(0x33cd, 0x00)
    imager.write(0x33ce, 0x10)
    imager.write(0x33cf, 0x20)
    imager.write(0x33d0, 0xd6)
    imager.write(0x33d1, 0x15)
    imager.write(0x33d2, 0x01)
    imager.write(0x33d3, 0x00)
    imager.write(0x33d4, 0x10)
    imager.write(0x33d5, 0x30)
    imager.write(0x33d6, 0xd6)
    imager.write(0x33d7, 0x15)
    imager.write(0x33d8, 0x01)
    imager.write(0x33d9, 0x00)
    imager.write(0x33da, 0x10)
    imager.write(0x33db, 0x20)
    imager.write(0x33dc, 0xd6)
    imager.write(0x33dd, 0x15)
    imager.write(0x33de, 0x01)
    imager.write(0x33df, 0x00)
    imager.write(0x33e0, 0x10)
    imager.write(0x33e1, 0x20)
    imager.write(0x33e2, 0x56)
    imager.write(0x33e3, 0x15)
    imager.write(0x33e4, 0x12)
    imager.write(0x33e5, 0x00)
    imager.write(0x33e6, 0x10)
    imager.write(0x33e7, 0x20)
    imager.write(0x33e8, 0x16)
    imager.write(0x33e9, 0x15)
    imager.write(0x3060, 0x26)
    imager.write(0x3061, 0x00)
    imager.write(0x302a, 0xff)
    imager.write(0x302b, 0xff)
    imager.write(0x302c, 0xff)
    imager.write(0x302d, 0xff)
    imager.write(0x302e, 0x3f)
    calc_len_eoi(imager)
    imager.write(0x3013, 0x0b)
    imager.write(0x3090, 0x2e)
    imager.write(0x3091, 0x01)
    imager.write(0x30c6, 0x05)
    imager.write(0x30c7, 0x00)
    imager.write(0x30c8, 0x00)
    imager.write(0x30c9, 0x00)
    imager.write(0x30ca, 0x00)
    imager.write(0x30cb, 0x00)
    imager.write(0x30cc, 0x00)
    imager.write(0x30cd, 0x00)
    imager.write(0x30ce, 0x00)
    imager.write(0x30cf, 0x05)
    imager.write(0x30d0, 0x00)
    imager.write(0x30d1, 0x00)
    imager.write(0x30d2, 0x00)
    imager.write(0x30d3, 0x00)
    imager.write(0x30d4, 0x00)
    imager.write(0x30d5, 0x00)
    imager.write(0x30d6, 0x00)
    imager.write(0x30d7, 0x00)
    imager.write(0x30f3, 0x05)
    imager.write(0x30f4, 0x00)
    imager.write(0x30f5, 0x00)
    imager.write(0x30f6, 0x00)
    imager.write(0x30f7, 0x00)
    imager.write(0x30f8, 0x00)
    imager.write(0x30f9, 0x00)
    imager.write(0x30fa, 0x00)
    imager.write(0x30fb, 0x00)
    imager.write(0x30d8, 0x05)
    imager.write(0x30d9, 0x00)
    imager.write(0x30da, 0x00)
    imager.write(0x30db, 0x00)
    imager.write(0x30dc, 0x00)
    imager.write(0x30dd, 0x00)
    imager.write(0x30de, 0x00)
    imager.write(0x30df, 0x00)
    imager.write(0x30e0, 0x00)
    imager.write(0x30e1, 0x05)
    imager.write(0x30e2, 0x00)
    imager.write(0x30e3, 0x00)
    imager.write(0x30e4, 0x00)
    imager.write(0x30e5, 0x00)
    imager.write(0x30e6, 0x00)
    imager.write(0x30e7, 0x00)
    imager.write(0x30e8, 0x00)
    imager.write(0x30e9, 0x00)
    imager.write(0x30f3, 0x05)
    imager.write(0x30f4, 0x02)
    imager.write(0x30f5, 0x00)
    imager.write(0x30f6, 0x17)
    imager.write(0x30f7, 0x01)
    imager.write(0x30f8, 0x00)
    imager.write(0x30f9, 0x00)
    imager.write(0x30fa, 0x00)
    imager.write(0x30fb, 0x00)
    imager.write(0x30d8, 0x03)
    imager.write(0x30d9, 0x01)
    imager.write(0x30da, 0x00)
    imager.write(0x30db, 0x19)
    imager.write(0x30dc, 0x01)
    imager.write(0x30dd, 0x00)
    imager.write(0x30de, 0x00)
    imager.write(0x30df, 0x00)
    imager.write(0x30e0, 0x00)
    imager.write(0x30a2, 0x05)
    imager.write(0x30a3, 0x02)
    imager.write(0x30a4, 0x00)
    imager.write(0x30a5, 0x22)
    imager.write(0x30a6, 0x00)
    imager.write(0x30a7, 0x00)
    imager.write(0x30a8, 0x00)
    imager.write(0x30a9, 0x00)
    imager.write(0x30aa, 0x00)
    imager.write(0x30ab, 0x05)
    imager.write(0x30ac, 0x02)
    imager.write(0x30ad, 0x00)
    imager.write(0x30ae, 0x22)
    imager.write(0x30af, 0x00)
    imager.write(0x30b0, 0x00)
    imager.write(0x30b1, 0x00)
    imager.write(0x30b2, 0x00)
    imager.write(0x30b3, 0x00)
    imager.write(0x30bd, 0x05)
    imager.write(0x30be, 0x9f)
    imager.write(0x30bf, 0x00)
    imager.write(0x30c0, 0x7d)
    imager.write(0x30c1, 0x00)
    imager.write(0x30c2, 0x00)
    imager.write(0x30c3, 0x00)
    imager.write(0x30c4, 0x00)
    imager.write(0x30c5, 0x00)
    imager.write(0x30b4, 0x04)
    imager.write(0x30b5, 0x9c)
    imager.write(0x30b6, 0x00)
    imager.write(0x30b7, 0x7d)
    imager.write(0x30b8, 0x00)
    imager.write(0x30b9, 0x00)
    imager.write(0x30ba, 0x00)
    imager.write(0x30bb, 0x00)
    imager.write(0x30bc, 0x00)
    imager.write(0x30fc, 0x05)
    imager.write(0x30fd, 0x00)
    imager.write(0x30fe, 0x00)
    imager.write(0x30ff, 0x00)
    imager.write(0x3100, 0x00)
    imager.write(0x3101, 0x00)
    imager.write(0x3102, 0x00)
    imager.write(0x3103, 0x00)
    imager.write(0x3104, 0x00)
    imager.write(0x3105, 0x05)
    imager.write(0x3106, 0x00)
    imager.write(0x3107, 0x00)
    imager.write(0x3108, 0x00)
    imager.write(0x3109, 0x00)
    imager.write(0x310a, 0x00)
    imager.write(0x310b, 0x00)
    imager.write(0x310c, 0x00)
    imager.write(0x310d, 0x00)
    imager.write(0x3099, 0x05)
    imager.write(0x309a, 0x96)
    imager.write(0x309b, 0x00)
    imager.write(0x309c, 0x06)
    imager.write(0x309d, 0x00)
    imager.write(0x309e, 0x00)
    imager.write(0x309f, 0x00)
    imager.write(0x30a0, 0x00)
    imager.write(0x30a1, 0x00)
    imager.write(0x310e, 0x05)
    imager.write(0x310f, 0x02)
    imager.write(0x3110, 0x00)
    imager.write(0x3111, 0x2b)
    imager.write(0x3112, 0x00)
    imager.write(0x3113, 0x00)
    imager.write(0x3114, 0x00)
    imager.write(0x3115, 0x00)
    imager.write(0x3116, 0x00)
    imager.write(0x3117, 0x05)
    imager.write(0x3118, 0x02)
    imager.write(0x3119, 0x00)
    imager.write(0x311a, 0x2c)
    imager.write(0x311b, 0x00)
    imager.write(0x311c, 0x00)
    imager.write(0x311d, 0x00)
    imager.write(0x311e, 0x00)
    imager.write(0x311f, 0x00)
    imager.write(0x30ea, 0x00)
    imager.write(0x30eb, 0x00)
    imager.write(0x30ec, 0x00)
    imager.write(0x30ed, 0x00)
    imager.write(0x30ee, 0x00)
    imager.write(0x30ef, 0x00)
    imager.write(0x30f0, 0x00)
    imager.write(0x30f1, 0x00)
    imager.write(0x30f2, 0x00)
    imager.write(0x313b, 0x03)
    imager.write(0x313c, 0x31)
    imager.write(0x313d, 0x00)
    imager.write(0x313e, 0x07)
    imager.write(0x313f, 0x00)
    imager.write(0x3140, 0x68)
    imager.write(0x3141, 0x00)
    imager.write(0x3142, 0x34)
    imager.write(0x3143, 0x00)
    imager.write(0x31a0, 0x03)
    imager.write(0x31a1, 0x16)
    imager.write(0x31a2, 0x00)
    imager.write(0x31a3, 0x08)
    imager.write(0x31a4, 0x00)
    imager.write(0x31a5, 0x7e)
    imager.write(0x31a6, 0x00)
    imager.write(0x31a7, 0x08)
    imager.write(0x31a8, 0x00)
    imager.write(0x31a9, 0x03)
    imager.write(0x31aa, 0x16)
    imager.write(0x31ab, 0x00)
    imager.write(0x31ac, 0x08)
    imager.write(0x31ad, 0x00)
    imager.write(0x31ae, 0x7e)
    imager.write(0x31af, 0x00)
    imager.write(0x31b0, 0x08)
    imager.write(0x31b1, 0x00)
    imager.write(0x31b2, 0x03)
    imager.write(0x31b3, 0x16)
    imager.write(0x31b4, 0x00)
    imager.write(0x31b5, 0x08)
    imager.write(0x31b6, 0x00)
    imager.write(0x31b7, 0x7e)
    imager.write(0x31b8, 0x00)
    imager.write(0x31b9, 0x08)
    imager.write(0x31ba, 0x00)
    imager.write(0x3120, 0x05)
    imager.write(0x3121, 0x45)
    imager.write(0x3122, 0x00)
    imager.write(0x3123, 0x1d)
    imager.write(0x3124, 0x00)
    imager.write(0x3125, 0xa9)
    imager.write(0x3126, 0x00)
    imager.write(0x3127, 0x6d)
    imager.write(0x3128, 0x00)
    imager.write(0x3129, 0x05)
    imager.write(0x312a, 0x15)
    imager.write(0x312b, 0x00)
    imager.write(0x312c, 0x0a)
    imager.write(0x312d, 0x00)
    imager.write(0x312e, 0x45)
    imager.write(0x312f, 0x00)
    imager.write(0x3130, 0x1d)
    imager.write(0x3131, 0x00)
    imager.write(0x3132, 0x05)
    imager.write(0x3133, 0x7d)
    imager.write(0x3134, 0x00)
    imager.write(0x3135, 0x0a)
    imager.write(0x3136, 0x00)
    imager.write(0x3137, 0xa9)
    imager.write(0x3138, 0x00)
    imager.write(0x3139, 0x6d)
    imager.write(0x313a, 0x00)
    imager.write(0x3144, 0x05)
    imager.write(0x3145, 0x00)
    imager.write(0x3146, 0x00)
    imager.write(0x3147, 0x30)
    imager.write(0x3148, 0x00)
    imager.write(0x3149, 0x00)
    imager.write(0x314a, 0x00)
    imager.write(0x314b, 0x00)
    imager.write(0x314c, 0x00)
    imager.write(0x314d, 0x03)
    imager.write(0x314e, 0x00)
    imager.write(0x314f, 0x00)
    imager.write(0x3150, 0x31)
    imager.write(0x3151, 0x00)
    imager.write(0x3152, 0x00)
    imager.write(0x3153, 0x00)
    imager.write(0x3154, 0x00)
    imager.write(0x3155, 0x00)
    imager.write(0x31d8, 0x05)
    imager.write(0x31d9, 0x3a)
    imager.write(0x31da, 0x00)
    imager.write(0x31db, 0x2e)
    imager.write(0x31dc, 0x00)
    imager.write(0x31dd, 0x9e)
    imager.write(0x31de, 0x00)
    imager.write(0x31df, 0x7e)
    imager.write(0x31e0, 0x00)
    imager.write(0x31e1, 0x05)
    imager.write(0x31e2, 0x04)
    imager.write(0x31e3, 0x00)
    imager.write(0x31e4, 0x04)
    imager.write(0x31e5, 0x00)
    imager.write(0x31e6, 0x73)
    imager.write(0x31e7, 0x00)
    imager.write(0x31e8, 0x04)
    imager.write(0x31e9, 0x00)
    imager.write(0x31ea, 0x05)
    imager.write(0x31eb, 0x00)
    imager.write(0x31ec, 0x00)
    imager.write(0x31ed, 0x00)
    imager.write(0x31ee, 0x00)
    imager.write(0x31ef, 0x00)
    imager.write(0x31f0, 0x00)
    imager.write(0x31f1, 0x00)
    imager.write(0x31f2, 0x00)
    imager.write(0x31f3, 0x00)
    imager.write(0x31f4, 0x00)
    imager.write(0x31f5, 0x00)
    imager.write(0x31f6, 0x00)
    imager.write(0x31f7, 0x00)
    imager.write(0x31f8, 0x00)
    imager.write(0x31f9, 0x00)
    imager.write(0x31fa, 0x00)
    imager.write(0x31fb, 0x05)
    imager.write(0x31fc, 0x00)
    imager.write(0x31fd, 0x00)
    imager.write(0x31fe, 0x00)
    imager.write(0x31ff, 0x00)
    imager.write(0x3200, 0x00)
    imager.write(0x3201, 0x00)
    imager.write(0x3202, 0x00)
    imager.write(0x3203, 0x00)
    imager.write(0x3204, 0x00)
    imager.write(0x3205, 0x00)
    imager.write(0x3206, 0x00)
    imager.write(0x3207, 0x00)
    imager.write(0x3208, 0x00)
    imager.write(0x3209, 0x00)
    imager.write(0x320a, 0x00)
    imager.write(0x320b, 0x00)
    imager.write(0x3164, 0x05)
    imager.write(0x3165, 0x14)
    imager.write(0x3166, 0x00)
    imager.write(0x3167, 0x0c)
    imager.write(0x3168, 0x00)
    imager.write(0x3169, 0x44)
    imager.write(0x316a, 0x00)
    imager.write(0x316b, 0x1f)
    imager.write(0x316c, 0x00)
    imager.write(0x316d, 0x05)
    imager.write(0x316e, 0x7c)
    imager.write(0x316f, 0x00)
    imager.write(0x3170, 0x0c)
    imager.write(0x3171, 0x00)
    imager.write(0x3172, 0xa8)
    imager.write(0x3173, 0x00)
    imager.write(0x3174, 0x6f)
    imager.write(0x3175, 0x00)
    imager.write(0x31c4, 0x05)
    imager.write(0x31c5, 0x24)
    imager.write(0x31c6, 0x01)
    imager.write(0x31c7, 0x04)
    imager.write(0x31c8, 0x00)
    imager.write(0x31c9, 0x05)
    imager.write(0x31ca, 0x24)
    imager.write(0x31cb, 0x01)
    imager.write(0x31cc, 0x04)
    imager.write(0x31cd, 0x00)
    imager.write(0x31ce, 0x05)
    imager.write(0x31cf, 0x24)
    imager.write(0x31d0, 0x01)
    imager.write(0x31d1, 0x04)
    imager.write(0x31d2, 0x00)
    imager.write(0x31d3, 0x05)
    imager.write(0x31d4, 0x73)
    imager.write(0x31d5, 0x00)
    imager.write(0x31d6, 0xb1)
    imager.write(0x31d7, 0x00)
    imager.write(0x3176, 0x05)
    imager.write(0x3177, 0x10)
    imager.write(0x3178, 0x00)
    imager.write(0x3179, 0x56)
    imager.write(0x317a, 0x00)
    imager.write(0x317b, 0x00)
    imager.write(0x317c, 0x00)
    imager.write(0x317d, 0x00)
    imager.write(0x317e, 0x00)
    imager.write(0x317f, 0x05)
    imager.write(0x3180, 0x6a)
    imager.write(0x3181, 0x00)
    imager.write(0x3182, 0xad)
    imager.write(0x3183, 0x00)
    imager.write(0x3184, 0x00)
    imager.write(0x3185, 0x00)
    imager.write(0x3186, 0x00)
    imager.write(0x3187, 0x00)
    imager.write(0x4047, 0x8f)
    imager.write(0x4026, 0x1f)
    imager.write(0x4044, 0x65)
    imager.write(0x1035, 0x54)
    imager.write(0x1002, 0x04)
    imager.write(0x1003, 0x10)
    imager.write(0x1003, 0x04)
    imager.write(0x400a, 0x08)
    imager.write(0x402a, 0x6c)
    imager.write(0x320d, 0x64)
    imager.write(0x3212, 0x64)
    imager.write(0x1002, 0x04)
    imager.write(0x1003, 0x10)
    imager.write(0x208d, 0x04)
    imager.write(0x208e, 0x00)
    imager.write(0x209e, 0x02)
    imager.write(0x2062, 0x01)
    imager.write(0x1002, 0x04)
    imager.write(0x1003, 0x10)
    imager.write(0x100c, 0x7e)
    imager.write(0x100d, 0x00)
    imager.write(0x1012, 0xdf)
    imager.write(0x1013, 0x2b)
    imager.write(0x100d, 0x00)
    imager.write(0x1012, 0x37)
    imager.write(0x1013, 0x5d)
    imager.write(0x402c, 0x64)
    imager.write(0x4006, 0x08)
    imager.write(0x402b, 0x06)
    imager.write(0x403b, 0x0b)
    imager.write(0x4047, 0x8f)
    imager.write(0x4032, 0x53)
    imager.write(0x4036, 0x17)
    imager.write(0x403e, 0x0e)
    imager.write(0x204b, 0x03)
    imager.write(0x401c, 0x6f)
    imager.write(0x205b, 0x2c)
    imager.write(0x205c, 0x01)
    trim_restore(imager)
    return 0

